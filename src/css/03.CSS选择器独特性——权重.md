## CSS选择器独特性——权重

### 概述

在[CSS选择器](https://github.com/jhaofan/jhaofan.github.io/blob/master/src/css/02.CSS%E9%80%89%E6%8B%A9%E5%99%A8.md)中简单介绍了选择器的类型，而每个HTML元素都有可能匹配上多个选择器，每个选择器中的规则集又可能存在相同的规则，这个时候就需要比较一下每个选择器的权重关系了。



### 计算规则

首先，需要定义一下权重等级：A > B > C。对应关系如下：

| 选择器/[伪元素](<https://drafts.csswg.org/selectors-4/#pseudo-elements>) | 权重等级(从高到底) |
| :----------------------------------------------------------: | :----------------: |
|                           ID选择器                           |         A          |
|               类选择器、属性选择器、伪类选择器               |         B          |
|                      类型选择器、伪元素                      |         C          |
|                          通用选择器                          |        忽略        |
|          复合选择器、组合器(关系选择器)、复杂选择器          |      拆分计算      |

对于每个元素匹配的复杂选择器，细粒度拆分为简单选择器后，按照表中对应的权限等级分别计算数量值。通过依次比较三个等级数量值来决定权重关系，所比较的权重等级值越高则优先级越大。

```scss
// 以下以0-0-0来代表A-B-C各个权重等级数量

// 1-0-0
#myid {}
// 0-1-0
.myclass {}
// 0-0-1
div {}
// 0-0-0
* {}

// 0-0-2
div span {}
// 0-0-3
div span + img {}
// 0-2-1
div.level.box {}
// 0-2-1
div[data-foo]:hover {}

```



### 特殊伪类

一些伪类为选择器提供了评估上下文，因此具有特殊的权重规则。

|                      伪类类型                       | 规则描述                                               |
| :-------------------------------------------------: | ------------------------------------------------------ |
|       :is(CS1, CS2, ...)、:not(CS1, CS2, ...)       | 由其选择器列表中权重最大的值决定                       |
|                 :has(RS1, RS2, ...)                 | 由其选择器列表中权重最大的值决定                       |
| :nth-child(An+B of CS)、:nth-last-child(An+B of CS) | 由其选择器列表中权重最大的值加上伪类对应权限等级值决定 |
|                :where(CS1, CS2, ...)                | 无权重，即0-0-0                                        |

```scss
// 1-0-0
:is(div, #myid) {}
// 0-2-0
:nth-child(even of div, .myclass) {}
```



### 来源/声明

除了选择器的权重会影响规则集的应用关系，规则集的来源或声明也会影响其应用关系，规则如下：

| 样式来源/声明（读取优先级从高到低） |                             说明                             |
| :---------------------------------: | :----------------------------------------------------------: |
|             !important              |                 在规则属性值后声明!important                 |
|            元素内联样式             |                     规则直接应用在元素上                     |
|          文档内联/引入样式          | 规则通过选择器应用在元素上，位于当前文档内或通过特定方式引入 |
|              用户样式               |                       用户自定义规则集                       |
|             浏览器样式              |                       浏览器默认规则集                       |



### [计算规则和特殊伪类详见草案](https://drafts.csswg.org/selectors-4/#specificity-rules)